name: Build Release

on:
  release:
    types: [published]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'
    
    - name: Restore dependencies
      run: dotnet restore
    
    - name: Build Release
      run: dotnet build --configuration Release --no-restore
    
    - name: Generate checksums
      run: |
        $exe = "bin/Release/net10.0-windows/league-mastery-overlay.exe"
        $sha256 = (Get-FileHash $exe -Algorithm SHA256).Hash
        $md5 = (Get-FileHash $exe -Algorithm MD5).Hash
        Add-Content -Path "checksums.txt" -Value "SHA256: $sha256"
        Add-Content -Path "checksums.txt" -Value "MD5: $md5"
        Add-Content -Path "checksums.txt" -Value "File: $(Split-Path $exe -Leaf)"
      shell: powershell
    
    - name: Upload artifact to release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          bin/Release/net10.0-windows/league-mastery-overlay.exe
          checksums.txt
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}


